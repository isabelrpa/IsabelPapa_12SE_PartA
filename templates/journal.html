{% extends "base.html" %}

{% block head %}
<header>
    <h1>
        <a href="/">TRIPTROVE</a>
    </h1>
    <nav>
        <a href="/journal/add/{{ trip_id }}" class="new-entry-btn">New Entry</a>
        <a href="#" class="sort-btn">Sort</a>
    </nav>
</header>
{% endblock %}

{% block body %}
<div class="journal-full-container">
    <h2 class="journal-title">Journal</h2>
    
    {% if entries %}
    <div class="journal-entries-full">
        {% for entry in entries %}
        <div class="journal-entry">
            <div class="entry-header">
                <h3 class="entry-date">{{ entry[0] }}</h3>
                <div style="position: relative;">
                    <span class="entry-menu" data-entry-id="{{ entry[2] }}">•••</span>
                    <div class="popup-menu entry-popup" id="entry-popup-{{ entry[2] }}">
                        <h1>MANAGE ENTRY</h1>
                        <a href="/journal/update/{{ entry[2] }}" class="popup-option update-option"> → Edit</a>
                        <a href="/journal/delete/{{ entry[2] }}" class="popup-option delete-option" onclick="return confirm('Are you sure you want to delete this entry?')"> → Delete</a>
                    </div>
                </div>
            </div>
            <p class="entry-text">{{ entry[1] }}</p>
        </div>
        {% if not loop.last %}
        <hr class="entry-divider">
        {% endif %}
        {% endfor %}
    </div>
    {% else %}
    <p class="no-entries">No journal entries yet. Click "New Entry" to add one!</p>
    {% endif %}
    
    <a href="/trip/{{ trip_id }}" class="back-btn">← Back</a>
</div>

<script>
// Toggle popup menu when entry menu is clicked
document.addEventListener('DOMContentLoaded', function() {
    const entryMenus = document.querySelectorAll('.entry-menu');
    
    entryMenus.forEach(function(menu) {
        menu.addEventListener('click', function(e) {
            e.stopPropagation();
            const entryId = this.getAttribute('data-entry-id');
            const popup = document.getElementById('entry-popup-' + entryId);
            
            // Close all other popups
            document.querySelectorAll('.entry-popup').forEach(function(p) {
                if (p.id !== 'entry-popup-' + entryId) {
                    p.classList.remove('show');
                }
            });
            
            popup.classList.toggle('show');
        });
    });

    // Close popup when clicking outside
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.entry-menu') && !e.target.closest('.popup-menu')) {
            document.querySelectorAll('.entry-popup').forEach(function(popup) {
                popup.classList.remove('show');
            });
        }
    });
});
</script>
{% endblock %}

{% block footer %}
<p>TRIPTROVE 2025</p>
{% endblock %}